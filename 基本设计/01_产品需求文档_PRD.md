# VoiceGrow 产品需求文档 (PRD)

> 版本: v1.0
> 更新日期: 2026-01-12
> 状态: 初稿

---

## 1. 产品概述

### 1.1 产品定位

**VoiceGrow（声伴成长）** 是一个基于小爱音箱改造的语音交互学习与陪伴平台，以儿童学习为核心场景，提供故事播放、音乐欣赏、英语学习和智能对话功能。

### 1.2 目标用户

| 用户类型 | 年龄范围 | 核心需求 |
|---------|---------|---------|
| 婴幼儿 | 0-3岁 | 胎教音乐、摇篮曲、简单认知 |
| 学龄前儿童 | 3-6岁 | 儿童故事、儿歌、英语启蒙 |
| 小学生 | 6-12岁 | 故事、英语学习、智能问答 |
| 家长 | - | 内容管理、使用监控、模式切换 |

### 1.3 产品目标

- **MVP目标**: 实现基础语音交互，支持儿童故事/音乐播放和简单英语学习
- **短期目标**: 完善英语学习功能，增加智能对话陪伴
- **长期目标**: 构建可扩展的多语言学习内容平台

---

## 2. 硬件平台

### 2.1 目标设备

基于 **小爱音箱** 进行改造，使用 [open-xiaoai](https://github.com/idootop/open-xiaoai) 项目的 Rust 客户端。

### 2.2 支持的设备型号

⚠️ **仅支持以下两款型号，其他型号不兼容：**

| 型号 | 产品名称 |
|-----|---------|
| **LX06** | 小爱音箱 Pro |
| **OH2P** | Xiaomi Smart Speaker Pro |

### 2.3 硬件要求

| 组件 | 要求 |
|-----|-----|
| 设备型号 | LX06 或 OH2P |
| 网络 | WiFi 2.4GHz/5GHz（需与服务端同局域网） |
| 固件 | 需刷写自定义固件以获取SSH访问 |
| 麦克风 | 原生麦克风阵列 |
| 扬声器 | 原生扬声器 |

---

## 3. 功能需求

### 3.1 核心功能矩阵

| 功能模块 | MVP | Phase 2 | Phase 3 | 优先级 |
|---------|-----|---------|---------|--------|
| 语音唤醒 | ✅ | ✅ | ✅ | P0 |
| 语音识别(ASR) | ✅ | ✅ | ✅ | P0 |
| 儿童故事播放 | ✅ | ✅ | ✅ | P0 |
| 儿童音乐播放 | ✅ | ✅ | ✅ | P0 |
| 英语学习 | ✅ | ✅ | ✅ | P1 |
| 智能对话 | ✅ | ✅ | ✅ | P1 |
| 日语学习 | ❌ | ✅ | ✅ | P2 |
| 内容推荐 | ❌ | ❌ | ✅ | P3 |
| 多用户支持 | ❌ | ❌ | ✅ | P3 |

### 3.2 语音唤醒模块

#### 3.2.1 功能描述
设备持续监听环境音频，检测到唤醒词后激活交互模式。

#### 3.2.2 需求详情

| 需求ID | 需求描述 | 优先级 |
|-------|---------|--------|
| WW-001 | MVP阶段使用原有"小爱同学"唤醒词 | P0 |
| WW-002 | 后续支持自定义唤醒词（如"小声同学"、"声伴宝贝"） | P2 |
| WW-003 | 唤醒响应时间 < 500ms | P0 |
| WW-004 | 唤醒准确率 > 95%（安静环境） | P0 |
| WW-005 | 唤醒后播放提示音 | P0 |

#### 3.2.3 技术方案

**MVP阶段**：
- 使用小爱音箱原有的"小爱同学"唤醒词机制
- 由 open-xiaoai 客户端处理唤醒检测

**后续扩展**：
- 可集成 **Porcupine** 或 **Snowboy** 进行自定义唤醒词检测
- 训练自定义唤醒词模型

### 3.3 语音识别(ASR)模块

#### 3.3.1 功能描述
将用户语音转换为文本，支持中文为主，英文为辅。

#### 3.3.2 需求详情

| 需求ID | 需求描述 | 优先级 |
|-------|---------|--------|
| ASR-001 | 支持普通话识别，准确率 > 90% | P0 |
| ASR-002 | 支持儿童语音识别 | P0 |
| ASR-003 | 本地离线识别能力 | P0 |
| ASR-004 | 识别延迟 < 2秒 | P1 |
| ASR-005 | 支持英文单词/短句识别 | P1 |
| ASR-006 | 支持中英混合语音识别 | P2 |

#### 3.3.3 技术方案
- 使用 **Whisper** (OpenAI) 本地部署
- 考虑使用 whisper.cpp 或 faster-whisper 优化性能

### 3.4 儿童故事播放模块

#### 3.4.1 功能描述
通过语音指令播放预置的儿童故事内容。

#### 3.4.2 需求详情

| 需求ID | 需求描述 | 优先级 |
|-------|---------|--------|
| ST-001 | 支持语音指令播放故事（"讲个故事"、"我要听白雪公主"） | P0 |
| ST-002 | 支持故事分类（睡前故事、童话故事、寓言故事等） | P0 |
| ST-003 | 支持播放控制（暂停、继续、上一个、下一个） | P0 |
| ST-004 | 支持音量调节 | P0 |
| ST-005 | 支持故事收藏/喜欢标记 | P2 |
| ST-006 | 支持定时停止（睡前模式） | P1 |

#### 3.4.3 内容规划

| 故事类型 | 数量(MVP) | 时长范围 |
|---------|----------|---------|
| 睡前故事 | 50+ | 3-10分钟 |
| 经典童话 | 30+ | 5-15分钟 |
| 寓言故事 | 30+ | 2-5分钟 |
| 科普故事 | 20+ | 3-8分钟 |

### 3.5 儿童音乐播放模块

#### 3.5.1 功能描述
通过语音指令播放儿童音乐、儿歌、胎教音乐等。

#### 3.5.2 需求详情

| 需求ID | 需求描述 | 优先级 |
|-------|---------|--------|
| MU-001 | 支持语音指令播放音乐（"播放儿歌"、"来首小星星"） | P0 |
| MU-002 | 支持音乐分类（儿歌、胎教音乐、古典音乐、摇篮曲） | P0 |
| MU-003 | 支持播放控制 | P0 |
| MU-004 | 支持播放模式（单曲循环、列表循环、随机播放） | P1 |
| MU-005 | 支持歌单管理 | P2 |

#### 3.5.3 内容规划

| 音乐类型 | 数量(MVP) |
|---------|----------|
| 经典儿歌 | 100+ |
| 胎教音乐 | 50+ |
| 摇篮曲 | 30+ |
| 儿童古典 | 30+ |

### 3.6 英语学习模块

#### 3.6.1 功能描述
提供英语听力、单词学习、跟读练习等功能。

#### 3.6.2 需求详情

| 需求ID | 需求描述 | 优先级 |
|-------|---------|--------|
| EN-001 | 支持英语单词学习（发音+释义） | P0 |
| EN-002 | 支持英语跟读练习 | P1 |
| EN-003 | 支持简单英语对话场景 | P1 |
| EN-004 | 支持发音评测反馈 | P2 |
| EN-005 | 支持学习进度记录 | P2 |
| EN-006 | 支持分级内容（启蒙/基础/进阶） | P1 |

#### 3.6.3 学习内容规划

| 内容类型 | 数量(MVP) | 适用阶段 |
|---------|----------|---------|
| 基础单词 | 500+ | 启蒙 |
| 常用短语 | 200+ | 基础 |
| 情景对话 | 50+ | 进阶 |
| 英文儿歌 | 50+ | 全阶段 |

### 3.7 智能对话模块

#### 3.7.1 功能描述
基于大语言模型提供智能对话陪伴功能。

#### 3.7.2 需求详情

| 需求ID | 需求描述 | 优先级 |
|-------|---------|--------|
| CH-001 | 支持自然语言对话 | P0 |
| CH-002 | 支持儿童友好的回复风格 | P0 |
| CH-003 | 支持知识问答（十万个为什么） | P1 |
| CH-004 | 支持对话上下文记忆（单次会话） | P1 |
| CH-005 | 支持内容安全过滤 | P0 |
| CH-006 | 响应时间 < 3秒 | P1 |

#### 3.7.3 技术方案
- 云端API: OpenAI GPT / Anthropic Claude / 阿里通义千问
- 需配置儿童友好的 System Prompt
- 实现内容安全过滤机制

### 3.8 语音合成(TTS)模块

#### 3.8.1 功能描述
将文本转换为自然语音输出。

#### 3.8.2 需求详情

| 需求ID | 需求描述 | 优先级 |
|-------|---------|--------|
| TTS-001 | 支持中文语音合成 | P0 |
| TTS-002 | 支持英文语音合成 | P0 |
| TTS-003 | 支持儿童友好的音色 | P1 |
| TTS-004 | 支持语速调节 | P2 |
| TTS-005 | 合成延迟 < 1秒（首字节） | P1 |

#### 3.8.3 技术方案
- 云端TTS: Azure Speech / 阿里云TTS
- 选择温暖、亲切的音色

---

## 4. 交互设计

### 4.1 语音交互流程

```
用户说出唤醒词
    ↓
系统播放提示音（"我在"）
    ↓
用户说出指令
    ↓
系统识别并处理
    ↓
系统语音反馈/执行操作
    ↓
等待后续指令或超时退出
```

### 4.2 核心指令示例

| 场景 | 用户指令示例 |
|-----|-------------|
| 播放故事 | "讲个故事"、"我要听三只小猪"、"播放睡前故事" |
| 播放音乐 | "播放儿歌"、"来首小星星"、"播放胎教音乐" |
| 播放控制 | "暂停"、"继续"、"下一个"、"音量大一点" |
| 英语学习 | "学英语"、"苹果用英语怎么说"、"跟我读apple" |
| 智能对话 | "为什么天是蓝色的"、"给我讲个笑话"、"今天天气怎么样" |
| 系统控制 | "关机"、"设置闹钟"、"现在几点了" |

### 4.3 错误处理

| 错误场景 | 处理方式 |
|---------|---------|
| 未识别语音 | "抱歉，我没听清楚，请再说一次" |
| 无匹配内容 | "我还没学会这个呢，换一个试试吧" |
| 网络异常 | "网络好像出了点问题，稍后再试试" |
| 超时无响应 | 播放提示音后自动退出监听模式 |

---

## 5. 内容管理

### 5.1 存储架构

采用 **MinIO + MySQL** 架构进行内容管理：

| 组件 | 用途 | 说明 |
|-----|-----|-----|
| **MinIO** | 对象存储 | 存储音频文件（故事、音乐、英语内容） |
| **MySQL** | 元数据存储 | 存储内容元数据、检索路径、播放记录 |

```
┌─────────────────────────────────────────────────────────────┐
│                     内容管理架构                              │
│                                                             │
│  ┌─────────────┐      ┌─────────────┐      ┌─────────────┐ │
│  │   客户端    │ ──── │   服务端    │ ──── │   MySQL     │ │
│  │ (播放请求) │      │  (路径检索) │      │  (元数据)   │ │
│  └─────────────┘      └──────┬──────┘      └─────────────┘ │
│                              │                              │
│                              │ 返回MinIO URL                │
│                              ▼                              │
│                       ┌─────────────┐                      │
│                       │   MinIO     │                      │
│                       │ (音频文件)  │                      │
│                       └─────────────┘                      │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 MinIO 存储结构

```
voicegrow-bucket/
├── stories/              # 故事音频
│   ├── bedtime/          # 睡前故事
│   ├── fairy_tale/       # 童话故事
│   ├── fable/            # 寓言故事
│   └── science/          # 科普故事
├── music/                # 音乐音频
│   ├── nursery_rhyme/    # 儿歌
│   ├── lullaby/          # 摇篮曲
│   ├── prenatal/         # 胎教音乐
│   └── classical/        # 古典音乐
├── english/              # 英语学习内容
│   ├── words/            # 单词音频
│   ├── phrases/          # 短语音频
│   └── dialogues/        # 对话场景
└── covers/               # 封面图片（可选）
```

### 5.3 MySQL 数据模型

**内容表 (contents)**
```sql
CREATE TABLE contents (
    id INT PRIMARY KEY AUTO_INCREMENT,
    type VARCHAR(20) NOT NULL,           -- story, music, english
    category VARCHAR(50) NOT NULL,       -- bedtime, fairy_tale, etc.
    title VARCHAR(200) NOT NULL,
    description TEXT,
    duration INT,                        -- 时长(秒)
    age_min INT DEFAULT 0,
    age_max INT DEFAULT 99,
    tags JSON,                           -- ["经典", "勇气"]
    minio_path VARCHAR(500) NOT NULL,    -- MinIO对象路径
    cover_path VARCHAR(500),             -- 封面图路径
    play_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_type_category (type, category),
    INDEX idx_title (title)
);
```

**播放历史表 (play_history)**
```sql
CREATE TABLE play_history (
    id INT PRIMARY KEY AUTO_INCREMENT,
    device_id VARCHAR(100) NOT NULL,
    content_id INT NOT NULL,
    played_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    progress INT DEFAULT 0,              -- 播放进度(秒)
    completed BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (content_id) REFERENCES contents(id),
    INDEX idx_device_time (device_id, played_at)
);
```

### 5.4 内容检索流程

```
1. 客户端发送播放请求（如"播放睡前故事"）
2. 服务端解析意图，确定 type=story, category=bedtime
3. 服务端查询 MySQL 获取内容元数据
4. 服务端生成 MinIO 预签名URL（或直接返回路径）
5. 返回音频URL给客户端播放
```

### 5.5 内容元数据示例

```json
{
  "id": 1,
  "type": "story",
  "category": "fairy_tale",
  "title": "三只小猪",
  "description": "经典童话故事，讲述三只小猪建房子的故事",
  "duration": 480,
  "age_min": 3,
  "age_max": 8,
  "tags": ["经典", "勇气", "智慧"],
  "minio_path": "stories/fairy_tale/three_little_pigs.mp3",
  "cover_path": "covers/three_little_pigs.jpg",
  "play_count": 1234
}
```

---

## 6. 非功能性需求

### 6.1 性能要求

| 指标 | 要求 |
|-----|-----|
| 唤醒响应时间 | < 500ms |
| ASR识别延迟 | < 2s |
| TTS首字节延迟 | < 1s |
| 对话响应时间 | < 3s |
| 内存占用 | < 512MB |

### 6.2 可靠性要求

| 指标 | 要求 |
|-----|-----|
| 系统可用性 | > 99%（本地功能） |
| 崩溃恢复 | 自动重启，< 30s |
| 数据持久化 | 播放进度、收藏记录本地保存 |

### 6.3 安全要求

| 要求 | 描述 |
|-----|-----|
| 内容安全 | 所有内容经过儿童适宜性审核 |
| 对话安全 | LLM输出经过内容安全过滤 |
| 隐私保护 | 语音数据本地处理，不上传云端（ASR部分） |
| 使用时长 | 支持家长设置使用时长限制 |

---

## 7. 开发计划

### 7.1 MVP阶段（8-10周）

| 周次 | 里程碑 |
|-----|-------|
| W1-2 | 环境搭建、小爱音箱改造、基础框架 |
| W3-4 | 唤醒词检测、本地ASR集成 |
| W5-6 | 故事/音乐播放功能、内容管理 |
| W7-8 | 英语学习基础功能、TTS集成 |
| W9-10 | 智能对话集成、系统测试优化 |

### 7.2 Phase 2（6-8周）

- 英语学习功能增强（跟读评测）
- 日语学习模块
- 用户偏好学习
- 性能优化

### 7.3 Phase 3（8-10周）

- 内容推荐系统
- 多用户支持
- 学习报告
- 更多语言扩展

---

## 8. 风险与依赖

### 8.1 技术风险

| 风险 | 影响 | 缓解措施 |
|-----|-----|---------|
| 本地ASR性能不足 | 识别速度慢、准确率低 | 优化模型选择，考虑混合方案 |
| 小爱音箱刷机失败 | 无法使用设备 | 仔细阅读刷机教程，选择稳定版本固件 |
| open-xiaoai协议适配 | 服务端无法与客户端通信 | 深入研究open-xiaoai源码，先做连通性测试 |
| LLM响应延迟 | 对话体验差 | 优化prompt、考虑流式响应 |
| 网络延迟 | 整体响应慢 | 服务端部署在局域网内 |

### 8.2 依赖项

| 依赖 | 类型 | 状态 |
|-----|-----|-----|
| open-xiaoai | 开源项目（客户端） | **已确认使用** |
| 小爱音箱 Pro (LX06) 或 Smart Speaker Pro (OH2P) | 硬件 | **需购买** |
| Whisper模型 | AI模型 | 可用 |
| 云端LLM API | 外部服务 | 需申请 |
| 云端TTS API | 外部服务 | 需申请 |
| Porcupine | 唤醒词引擎 | 后续扩展需要 |

---

## 附录A: 术语表

| 术语 | 解释 |
|-----|-----|
| ASR | Automatic Speech Recognition，自动语音识别 |
| TTS | Text-to-Speech，文本转语音 |
| LLM | Large Language Model，大语言模型 |
| MVP | Minimum Viable Product，最小可行产品 |
| Wake Word | 唤醒词，用于激活语音助手的特定词语 |
